# Copyright (c) 2016-2022 Magnusson Institute, All Rights Reserved.

# See template.wrangler.toml for a template of this file

# Local (MINIFLARE) development of channel server

name = "c"

type = "javascript"
workers_dev = false
compatibility_date = "2022-02-01"

# for miniflare you don't need any IDs
kv_namespaces = [
    { binding = "MESSAGES_NAMESPACE", preview_id = "", id ="" },
    { binding = "KEYS_NAMESPACE", preview_id = "", id ="" },
    { binding = "LEDGER_NAMESPACE", preview_id = "", id = "" }
]

services = [
  { binding = "notifications", service = "notifications-dev", environment = "production" }
]

[build.upload]
format = "modules"
dir = "src"
main = "./index.js"
rules = [{type = "Data", globs = ["**/*.html"]}]

[durable_objects]
bindings = [
    { name = "channels", class_name = "ChannelServer" },
]

[miniflare]
kv_persist = true # Defaults to ./.mf/kv
durable_objects_persist = true # Defaults to ./.mf/do

[vars]
SERVER_SECRET="password"  # this isn't as bad as it looks - all it does is allow somebody to start a new channel
LEDGER_KEY='{"key_ops":["encr ...'  # see 'README', same (public) key as channel server uses
